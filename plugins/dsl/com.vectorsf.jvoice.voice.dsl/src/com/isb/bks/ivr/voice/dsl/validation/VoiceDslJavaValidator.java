/*
 * generated by Xtext
 */
package com.isb.bks.ivr.voice.dsl.validation;

import org.eclipse.core.resources.IFile;
import org.eclipse.core.resources.IFolder;
import org.eclipse.core.resources.IProject;
import org.eclipse.core.resources.ResourcesPlugin;
import org.eclipse.emf.common.util.URI;
import org.eclipse.xtext.validation.Check;

import com.vectorsf.jvoice.prompt.model.voiceDsl.Audio;
import com.vectorsf.jvoice.prompt.model.voiceDsl.VoiceDslPackage;

/**
 * Custom validation rules.
 * 
 * see http://www.eclipse.org/Xtext/documentation.html#validation
 */
public class VoiceDslJavaValidator extends com.isb.bks.ivr.voice.dsl.validation.AbstractVoiceDslJavaValidator {

	@Check
	public void checkAudioContainsProperSrc(Audio audio) {
		if (audio.getSrc() != null) {
			URI uri = audio.eResource().getURI();
			IProject project = ResourcesPlugin.getWorkspace().getRoot().findMember(uri.toPlatformString(true))
					.getProject();
			IFolder audiosFolder = project.getFolder("/src/main/resources/audios");
			String audioName = audio.getSrc() + ".wav";
			IFile audioFile = audiosFolder.getFile(audioName);
			if (!audioFile.exists()) {
				error("Audio file not found", VoiceDslPackage.Literals.AUDIO__SRC);
			}
		}
	}
}
